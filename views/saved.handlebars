<nav class="navbar navbar-expand-lg navbar-light">
    <form action="" method="GET">
        <a class="navbar-brand" href="/saved">Saved Articles</a>
    </form>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup"
        aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggÃ¥ler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
        <div class="navbar-nav">
            <form action="/" method="GET"></form>
                <a class="nav-item nav-link active" href="/">Home
                <span class="sr-only">(current)</span>
                </a>
            </form>
        </div>
    </div>
</nav>

<div class="jumbotron">
</div>

<div id="saved">

    {{#each saved}}
        <div class="article-container" id="saved-article" >
            <a href={{link}} target="_blank"><h3 class="article-text">{{title}}</h3></a>
            <span class="article-date">{{date}}</span>
            <div class="article-footer">
                <button class="btn btn-danger" id="articleBtn" type="submit" data-id={{_id}}>Delete</button>
                <button class="btn btn-info" id="articleNoteBtn" type="submit" data-id={{_id}}>Write a note</button>
            </div>
        </div>
    {{/each}}
    <div id="notes"></div>
    <div id="message"></div>
</div>

<script type="text/javascript">

$(document).on("click", "#articleBtn", function(){

    var Articleid = $(this).attr("data-id");

    console.log(Articleid)

    $.ajax({
        method: "POST",
        url: "/delete/" + Articleid,
        data: {
            id: Articleid
        }
    }).done(function(data) {
        location.reload();
    });
})


$(document).on("click", "#articleNoteBtn", function(){

    var Articleid = $(this).attr("data-id");
    $("#notes").empty()

        $.ajax({
        method: "GET",
        url: "/articles/" + Articleid,
        data: {
            id: Articleid
        }
    }).done(function(data) {
        console.log(data)
      $("#notes").append("<h2>" + data.title + "</h2>");
      $("#notes").append("<input id='titleinput' name='title' >");
      $("#notes").append("<textarea id='bodyinput' name='body'></textarea>");
      $("#notes").append("<button data-id='" + data._id + "' id='savenote'>Save Note</button>");

      if (data.note) {
        $("#notes").append("<div><h3>" + data.note.title +  "</h3>" + "<p>" + data.note.body + "</p>" +  "</div>")
      }
    });
})

$(document).on("click", "#savenote", function(){
    var thisId = $(this).attr("data-id")
    console.log(thisId)

    $.ajax({
    method: "POST",
    url: "/articles/" + thisId,
    data: {
      // Value taken from title input
      title: $("#titleinput").val(),
      // Value taken from note textarea
      body: $("#bodyinput").val()
    }
  })
    // With that done
    .done(function(data) {
      // Log the response
      console.log(data);
      // Empty the notes section
     $("#notes").empty()
    });

  // Also, remove the values entered in the input and textarea for note entry
  $("#titleinput").val("");
  $("#bodyinput").val("");

});


</script>